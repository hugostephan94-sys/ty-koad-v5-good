"use strict";(()=>{var e={};e.id=757,e.ids=[757],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3292:e=>{e.exports=require("fs/promises")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1017:e=>{e.exports=require("path")},3837:e=>{e.exports=require("util")},4615:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var i={};a.r(i),a.d(i,{POST:()=>p});var r=a(9303),n=a(8716),s=a(670),o=a(3114),u=a(7070),c=a(8847);async function p(e){let t=e.headers.get("stripe-signature"),a=await e.text();try{let e=new o.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2024-06-20"}).webhooks.constructEvent(a,t,process.env.STRIPE_WEBHOOK_SECRET);if("payment_intent.succeeded"===e.type){let t=e.data.object;await (0,c.bA)({paymentIntentId:t.id,status:"paid"})}else if("payment_intent.payment_failed"===e.type){let t=e.data.object;await (0,c.bA)({paymentIntentId:t.id,status:"failed"})}return u.NextResponse.json({received:!0})}catch(e){return new u.NextResponse(`Webhook Error: ${e.message}`,{status:400})}}let d=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"C:\\Users\\Nina\\Downloads\\ty-koad-v5_1\\ty-koad-demo-v5.1\\app\\api\\stripe\\webhook\\route.js",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:w,serverHooks:f}=d,y="/api/stripe/webhook/route";function h(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},8847:(e,t,a)=>{a.d(t,{$:()=>x,KQ:()=>l,bA:()=>f,iD:()=>w,iE:()=>y,k3:()=>S,v6:()=>h});var i=a(3292),r=a.n(i),n=a(1017),s=a.n(n);let o=s().join(process.cwd(),"data"),u=s().join(o,"reservations.json"),c=s().join(o,"config.json"),p=s().join(o,"vouchers.json");async function d(){await r().mkdir(o,{recursive:!0});try{await r().access(u)}catch{await r().writeFile(u,"[]","utf-8")}try{await r().access(c)}catch{await r().writeFile(c,JSON.stringify({icalC1:"",icalC2:""},null,2),"utf-8")}try{await r().access(p)}catch{await r().writeFile(p,"[]","utf-8")}}async function l(){return await d(),JSON.parse(await r().readFile(u,"utf-8")||"[]")}async function w(e){await d();let t=await l();return t.unshift({...e,createdAt:new Date().toISOString()}),await r().writeFile(u,JSON.stringify(t,null,2),"utf-8"),{ok:!0}}async function f({paymentIntentId:e,...t}){await d();let a=await l(),i=a.findIndex(t=>t.paymentIntentId===e);return i>=0&&(a[i]={...a[i],...t}),await r().writeFile(u,JSON.stringify(a,null,2),"utf-8"),{ok:!0}}async function y(){return await d(),JSON.parse(await r().readFile(c,"utf-8")||"{}")}async function h(e){let t={...await y(),...e};return await r().writeFile(c,JSON.stringify(t,null,2),"utf-8"),t}let m=async()=>(await d(),JSON.parse(await r().readFile(p,"utf-8")||"[]")),v=async e=>r().writeFile(p,JSON.stringify(e,null,2),"utf-8");async function x(e){let t=await m();if(t.some(t=>t.code===e.code))throw Error("Code d\xe9j\xe0 existant");return t.unshift({...e,createdAt:new Date().toISOString(),status:"active",redemptions:[]}),await v(t),e}async function S(e){return(await m()).find(t=>t.stripeSessionId===e)||null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[948,972,749,114],()=>a(4615));module.exports=i})();